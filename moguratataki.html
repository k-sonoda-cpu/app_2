<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>モグラ叩き</title>
<style>
  /* ====== Base ====== */
  * { box-sizing: border-box; }
  body {
    margin: 0;
    min-height: 100vh;
    display: grid;
    place-items: center;
    gap: 16px;
    color: #eef2f6;
    background: linear-gradient(180deg, #0d1b2a, #1b263b);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic UI", "Yu Gothic", Meiryo, sans-serif;
  }

  /* ====== Control Panel ====== */
  .ui { text-align: center; }
  .ui h1 { margin: 16px 0 6px; font-weight: 800; letter-spacing: .02em; }
  .panel {
    display: inline-flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: center;
    background: rgba(255,255,255,.06);
    padding: 12px 14px; border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  .panel button { padding: 8px 14px; border-radius: 999px; border: 0; cursor: pointer; font-weight: 700; }
  .panel #start { background: #48bfe3; color: #0b132b; }
  .panel #stop  { background: #ef476f; color: #fff; }
  .panel label { display: inline-flex; align-items: center; gap: 6px; font-size: 14px; opacity: .92; }
  .panel input[type="number"] { width: 4.5rem; }
  .panel input[type="range"]  { width: 180px; }
  .stat { margin-top: 4px; font-weight: 700; }

  /* ====== Field ====== */
  :root { --cols: 3; --size: 140px; }
  .field {
    display: grid; grid-template-columns: repeat(var(--cols), var(--size)); gap: 14px;
    justify-content: center; align-items: center; padding: 12px;
    border-radius: 16px; background: rgba(0,0,0,.20);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.06);
  }

  /* ====== Hole (details) ====== */
  .hole { width: var(--size); height: var(--size); margin: 0; padding: 0; position: relative; border-radius: 18px;
          background:
            radial-gradient(120% 80% at 50% 110%, #0000 48%, rgba(0,0,0,.6) 49% 60%, #0000 61%),
            radial-gradient(circle at 50% 70%, #433522 0 55%, #2a2016 55% 100%);
          filter: drop-shadow(0 8px 16px rgba(0,0,0,.6));
          pointer-events: none; outline: none; border: 0;
  }
  /* hide the ▼/▶ marker */
  .hole > summary { list-style: none; }
  .hole > summary::-webkit-details-marker { display: none; }

  /* ====== Mole (summary) ====== */
  .mole { pointer-events: auto; position: absolute; left: 14%; bottom: -58%; width:72%; height:62%;
          border-radius: 56% 56% 48% 48%; outline: none;
          background: radial-gradient(circle at 50% 25%, #8a6a4d, #5b3f2b 60%);
          border: 3px solid #2e2218; box-shadow: 0 10px 0 rgba(0,0,0,.24), 0 2px 16px rgba(0,0,0,.48);
          transition: bottom .1s ease-out, transform .08s ease-out, filter .08s ease-out;
  }
  .hole[open] .mole { bottom: 12%; }

  /* face */
  .mole::before, .mole::after { content:""; position: absolute; top: 33%; width: 10px; height: 10px; border-radius: 50%; background: #111; }
  .mole::before { left: 34%; }
  .mole::after  { right: 34%; }
  .mole span { position: absolute; bottom: 12%; left: 50%; transform: translateX(-50%);
               width: 28px; height: 18px; background: #f3a683; border-radius: 50% / 60% 60% 40% 40%;
               box-shadow: inset 0 -3px 0 rgba(0,0,0,.2);}

  /* hit effect */
  .hole.bonk .mole { transform: translateY(2px) scale(.9); filter: brightness(.9); }

  /* disable selection */
  .mole, .panel, .ui { user-select: none; }

  /* focus ring for accessibility */
  .mole:focus-visible { box-shadow: 0 0 0 3px #48bfe3, 0 10px 0 rgba(0,0,0,.24); }

  /* reduce motion */
  @media (prefers-reduced-motion: reduce) { .mole { transition: none; } }
  @media (max-width: 500px) { :root { --size: 110px; } }
</style>
</head>
<body>
  <div class="ui">
    <h1>モグラ叩き</h1>
    <div class="panel" role="group" aria-label="ゲーム操作">
      <button id="start">スタート</button>
      <button id="stop" disabled>ストップ</button>
      <label>制限時間 <input id="duration" type="number" value="30" min="5" max="120" step="5"> 秒</label>
      <label>スピード(出現間隔)
        <input id="speed" type="range" min="250" max="1500" step="50" value="800">
        <output id="speedOut">800ms</output>
      </label>
      <div class="stat">スコア: <span id="score">0</span> / ベスト: <span id="best">0</span> | 残り: <span id="time">0</span>s</div>
    </div>
  </div>

  <div class="field" aria-label="フィールド">
    <!-- 3x3 holes -->
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
    <details class="hole"><summary class="mole" aria-label="モグラ"><span aria-hidden="true"></span></summary></details>
  </div>

  <script>
  (() => {
    const holes = Array.from(document.querySelectorAll('.hole'));
    const startBtn = document.getElementById('start');
    const stopBtn  = document.getElementById('stop');
    const durInput = document.getElementById('duration');
    const speedRange = document.getElementById('speed');
    const speedOut = document.getElementById('speedOut');
    const scoreEl = document.getElementById('score');
    const bestEl  = document.getElementById('best');
    const timeEl  = document.getElementById('time');

    let score = 0, best = 0, running = false;
    let spawnTimer = null, tickTimer = null, deadline = 0, lastHole = null;

    const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

    const updateSpeedLabel = () => { speedOut.textContent = parseInt(speedRange.value, 10) + 'ms'; };
    updateSpeedLabel();
    speedRange.addEventListener('input', updateSpeedLabel);

    // Count hits before default toggle; prevent opening on miss
    holes.forEach(hole => {
      const sm = hole.querySelector('summary');
      sm.addEventListener('click', (e) => {
        if (!running) { e.preventDefault(); return; }
        const wasOpen = hole.open; // state BEFORE toggle
        if (!wasOpen) { e.preventDefault(); return; } // miss => keep closed
        // hit!
        score++; scoreEl.textContent = score;
        hole.classList.add('bonk');
        setTimeout(() => hole.classList.remove('bonk'), 120);
        // Let default close it
      }, { capture: true });
    });

    function randomHole(exclude) {
      if (holes.length <= 1) return holes[0];
      let h; do { h = holes[Math.floor(Math.random() * holes.length)]; } while (h === exclude);
      return h;
    }

    function spawn() {
      if (!running) return;
      const h = randomHole(lastHole); lastHole = h;
      h.open = true;
      const upFor = Math.max(180, parseInt(speedRange.value, 10) * (0.6 + Math.random() * 0.6));
      setTimeout(() => { h.open = false; }, upFor);
    }

    function startGame() {
      if (running) return;
      running = true; score = 0; scoreEl.textContent = '0';
      const seconds = clamp(parseInt(durInput.value, 10) || 30, 5, 300); durInput.value = seconds;
      deadline = Date.now() + seconds * 1000;
      holes.forEach(h => h.open = false);

      const period = parseInt(speedRange.value, 10);
      spawnTimer = setInterval(spawn, period);
      tickTimer = setInterval(() => {
        const remMs = Math.max(0, deadline - Date.now());
        timeEl.textContent = Math.ceil(remMs / 1000);
        if (remMs <= 0) stopGame();
      }, 100);

      startBtn.disabled = true; stopBtn.disabled = false;
      spawn(); // first spawn immediately
    }

    function stopGame() {
      if (!running) return;
      running = false;
      clearInterval(spawnTimer); spawnTimer = null;
      clearInterval(tickTimer);  tickTimer  = null;
      holes.forEach(h => h.open = false);
      if (score > best) { best = score; bestEl.textContent = best; }
      startBtn.disabled = false; stopBtn.disabled = true;
    }

    startBtn.addEventListener('click', startGame);
    stopBtn.addEventListener('click', stopGame);

    // Keyboard support: Space/Enter on focused mole when open => hit
    document.addEventListener('keydown', (e) => {
      if (!running) return;
      if ((e.key === ' ' || e.key === 'Enter') && document.activeElement?.classList?.contains('mole')) {
        const hole = document.activeElement.parentElement;
        if (hole.open) { document.activeElement.click(); } else { e.preventDefault(); }
      }
    });
  })();
  </script>
</body>
</html>
